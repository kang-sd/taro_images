<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jennifer Canvas | AI íƒ€ë¡œ</title>
  <style>
    /* ë°ì€ ëŸ­ì…”ë¦¬ ë””ìì¸ ì ìš© */
    body { background: #fdfcf9; color: #333; font-family: 'Apple SD Gothic Neo', sans-serif; margin: 0; padding: 1rem; display: flex; justify-content: center; }
    .container { background: #fff; border-radius: 15px; padding: 2rem; box-shadow: 0 5px 25px rgba(0,0,0,0.05); width: 95vw; max-width: 600px; border: 1px solid #eee; }
    .title { text-align: center; font-size: 1.5rem; color: #c5a059; font-weight: bold; margin-bottom: 25px; letter-spacing: 1px; }
    
    .screen { display: none; }
    .active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* ì…ë ¥ í¼ ë° ë²„íŠ¼ */
    input, select, textarea { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
    .btn { background: #c5a059; color: #fff; border: none; padding: 16px; border-radius: 50px; width: 100%; font-size: 1.1rem; cursor: pointer; font-weight: bold; margin-bottom: 10px; transition: 0.3s; }
    .btn:hover { background: #b38e4a; }
    
    /* ì¹´ë“œ ê²°ê³¼ì°½ ë””ìì¸ */
    .res-card { background: #fafafa; border: 1px solid #eee; border-radius: 15px; padding: 25px; margin-bottom: 25px; text-align: left; }
    .card-result { width: 90px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 10px; }
    .card-label { font-size: 1.2rem; font-weight: bold; color: #c5a059; margin-bottom: 15px; }
    .d-label { font-weight: bold; color: #c5a059; margin-top: 15px; font-size: 0.85rem; border-bottom: 1px solid #eee; padding-bottom: 5px; }
    .d-content { margin-top: 5px; line-height: 1.6; color: #444; }
  </style>
</head>
<body>

<div class="container">
  <div class="title">âœ¨ JENNIFER CANVAS TAROT</div>

  <div id="screen1" class="screen active">
    <div style="background:#fffcf5; padding:15px; border-radius:12px; margin-bottom:20px; font-size:0.9rem; line-height:1.6; border:1px solid #f9f2e7; text-align:left;">
      <b style="color:#d9534f">íƒ€ë¡œë€?</b> ìƒì§•ì˜ ì¹´ë“œë¡œ ë‚´ë©´ê³¼ ê°ì •ì˜ íë¦„ì„ ë¹„ì¶”ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.<br>
      <b style="color:#d9534f">ì§ˆë¬¸ì€.</b> <b style="color:#4a90e2">ëª…í™•í•˜ê³  êµ¬ì²´ì ì¸ ì§ˆë¬¸ì´ ì •í™•ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.</b><br>
      ë‹¹ì‹ ì˜ ë§ˆìŒì´ ê°„ì ˆí•  ë•Œ ì¹´ë“œëŠ” <b style="color:#4a90e2">ë°©í–¥ì„ ì œì‹œí•©ë‹ˆë‹¤.</b><br>
      í•˜ë£¨ 2ë²ˆ ê°€ëŠ¥, 3ì¼ê°„ ì €ì¥ í›„ ìë™ ì‚­ì œë©ë‹ˆë‹¤.
    </div>
    <input type="text" id="uName" placeholder="ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”">
    <select id="uTopic">
      <option value="" disabled selected hidden>-- ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
      <option>ì—°ì• </option><option>ì§„ë¡œ/ì§ì—…</option><option>ê¸ˆì „</option><option>ê°ì •</option><option>ê±´ê°•</option>
      <option>ì‹œí—˜/í•©ê²©ìš´</option><option>ì„ íƒ/ê²°ì •</option><option>ì¸ê°„ê´€ê³„</option><option>ì˜ì  ë©”ì‹œì§€</option><option>ë¯¸ë˜ ì „ë°˜</option>
    </select>
    <textarea id="uQuest" rows="2" placeholder="ê³ ë¯¼ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
    <button class="btn" onclick="startShuffle()">ì…”í”Œ ì‹œì‘í•˜ê¸°</button>
  </div>

  <div id="screen2" class="screen">
    <h3 style="text-align:center; color:#c5a059;">ì¹´ë“œë¥¼ ë‘ ì¥ ê³ ë¥´ì„¸ìš”</h3>
    <div style="display:flex; justify-content:center; gap:20px; margin:30px 0;">
      <div id="slot1" style="width:130px; height:220px; background:url('https://kang-sd.github.io/taro_images/card_back.webp') center/cover; border-radius:12px; cursor:pointer;" onclick="pickCard(1)"></div>
      <div id="slot2" style="width:130px; height:220px; background:url('https://kang-sd.github.io/taro_images/card_back.webp') center/cover; border-radius:12px; cursor:pointer;" onclick="pickCard(2)"></div>
    </div>
    <button class="btn" id="resBtn" style="display:none;" onclick="fetchData()">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
  </div>

  <div id="screen3" class="screen">
    <div id="loadingMsg" style="text-align:center; padding:50px; font-weight:bold; color:#888;">ìš´ëª…ì˜ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    
    <div id="resultData" style="display:none;">
      <div class="res-card">
        <div id="cardName1"></div>
        <div class="d-label">ì£¼ìš” í‚¤ì›Œë“œ</div><div id="key1" class="d-content"></div>
        <div class="d-label">íƒ€ë¡œ í•´ì„</div><div id="int1" class="d-content" style="font-weight:bold; color:#111; border-left:3px solid #c5a059; padding-left:10px;"></div>
        <div class="d-label">ì¹´ë“œ ì„œì‚¬</div><div id="story1" class="d-content"></div>
        <div class="d-label">ê¸ì •/ë¶€ì • ìˆ˜ì¹˜</div><div id="pos1" class="d-content"></div>
        <div class="d-label">ê°ì •í†¤ ë° ì„¤ëª…</div><div class="d-content"><span id="tone1"></span> - <span id="desc1"></span></div>
        <div class="d-label">ê¸ì •ì  ì¸¡ë©´</div><div id="posAspect1" class="d-content"></div>
        <div class="d-label">ë¶€ì •ì  ì¸¡ë©´</div><div id="negAspect1" class="d-content"></div>
      </div>

      <div class="res-card">
        <div id="cardName2"></div>
        <div class="d-label">ì£¼ìš” í‚¤ì›Œë“œ</div><div id="key2" class="d-content"></div>
        <div class="d-label">íƒ€ë¡œ í•´ì„</div><div id="int2" class="d-content" style="font-weight:bold; color:#111; border-left:3px solid #c5a059; padding-left:10px;"></div>
        <div class="d-label">ì¹´ë“œ ì„œì‚¬</div><div id="story2" class="d-content"></div>
        <div class="d-label">ê¸ì •/ë¶€ì • ìˆ˜ì¹˜</div><div id="pos2" class="d-content"></div>
        <div class="d-label">ê°ì •í†¤ ë° ì„¤ëª…</div><div class="d-content"><span id="tone2"></span> - <span id="desc2"></span></div>
        <div class="d-label">ê¸ì •ì  ì¸¡ë©´</div><div id="posAspect2" class="d-content"></div>
        <div class="d-label">ë¶€ì •ì  ì¸¡ë©´</div><div id="negAspect2" class="d-content"></div>
      </div>

      <button class="btn" id="saveBtn" onclick="saveResult()" style="background:#222;">ì´ ê²°ê³¼ ì €ì¥í•˜ê¸° (3ì¼ ë³´ê´€)</button>
      <button class="btn" onclick="location.reload()" style="background:#eee; color:#666; box-shadow:none;">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
  </div>
</div>

<script>
  let picked = [null, null];
  const GAS_URL = "https://script.google.com/macros/s/AKfycby5tFp86x7LreN3E_5W89Yv8R_67J0x/exec"; // ëŒ€í‘œë‹˜ ì›ë³¸ URL

  function startShuffle() {
    if(!document.getElementById("uName").value || !document.getElementById("uTopic").value) {
      return alert("ì„±í•¨ê³¼ ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
    document.getElementById("screen1").classList.remove("active");
    document.getElementById("screen2").classList.add("active");
  }

  function pickCard(n) {
    if(picked[n-1] !== null) return;
    if(n==2 && picked[0] === null) return alert("ì²« ë²ˆì§¸ ì¹´ë“œë¥¼ ë¨¼ì € ê³¨ë¼ì£¼ì„¸ìš”.");
    const r = Math.floor(Math.random()*78);
    picked[n-1] = r;
    document.getElementById(`slot${n}`).style.backgroundImage = `url('https://kang-sd.github.io/taro_images/card_${r}.webp')`;
    if(picked[0] !== null && picked[1] !== null) document.getElementById("resBtn").style.display = "block";
  }

  // ğŸ”´ ëŒ€í‘œë‹˜ ì›ë³¸ ë¡œì§ 100% ë°˜ì˜ êµ¬ì—­
  async function fetchData() {
    document.getElementById("screen2").classList.remove("active");
    document.getElementById("screen3").classList.add("active");

    const name = encodeURIComponent(document.getElementById("uName").value);
    const topic = encodeURIComponent(document.getElementById("uTopic").value);
    const q = encodeURIComponent(document.getElementById("uQuest").value);
    const url = `${GAS_URL}?name=${name}&topic=${topic}&q=${q}&c1=${picked[0]}&c2=${picked[1]}`;

    try {
      const res = await fetch(url);
      const data = await res.json();
      
      const image1 = `https://kang-sd.github.io/taro_images/card_${picked[0]}.webp`;
      const image2 = `https://kang-sd.github.io/taro_images/card_${picked[1]}.webp`;

      // ì›ë³¸ ë°©ì‹ ê·¸ëŒ€ë¡œ IDì— ë°ì´í„° ê½‚ì•„ë„£ê¸°
      document.getElementById("cardName1").innerHTML = `<div style="text-align:center;"><img src="${image1}" class="card-result"><div class="card-label">[ê³¼ì •] ${data.card1.cardName}</div></div>`;
      document.getElementById("cardName2").innerHTML = `<div style="text-align:center;"><img src="${image2}" class="card-result"><div class="card-label">[ê²°ê³¼] ${data.card2.cardName}</div></div>`;

      document.getElementById("key1").innerText = data.card1.keywords;
      document.getElementById("key2").innerText = data.card2.keywords;
      document.getElementById("story1").innerText = data.card1.story;
      document.getElementById("story2").innerText = data.card2.story;
      
      document.getElementById("int1").innerText = data.card1.interpretation;
      document.getElementById("int2").innerText = data.card2.interpretation;
      document.getElementById("pos1").innerText = `ê¸ì • ${data.card1.positive} / ë¶€ì • ${data.card1.negative}`;
      document.getElementById("pos2").innerText = `ê¸ì • ${data.card2.positive} / ë¶€ì • ${data.card2.negative}`;
      
      document.getElementById("tone1").innerText = data.card1.tone;
      document.getElementById("tone2").innerText = data.card2.tone;
      document.getElementById("desc1").innerText = data.card1.description;
      document.getElementById("desc2").innerText = data.card2.description;
      
      document.getElementById("posAspect1").innerText = data.card1.positiveAspect;
      document.getElementById("posAspect2").innerText = data.card2.positiveAspect;
      document.getElementById("negAspect1").innerText = data.card1.negativeAspect;
      document.getElementById("negAspect2").innerText = data.card2.negativeAspect;

      // ë¡œë”© ìˆ¨ê¸°ê³  ê²°ê³¼ í‘œì‹œ
      document.getElementById("loadingMsg").style.display = "none";
      document.getElementById("resultData").style.display = "block";

    } catch (e) {
      document.getElementById("loadingMsg").innerHTML = `<span style='color:red;'>ë°ì´í„° ì—°ê²° ì‹¤íŒ¨ (CORS ë˜ëŠ” URL ì˜¤ë¥˜). Apps Scriptë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.</span><br><br>ì—ëŸ¬ ë‚´ì—­: ${e.message}`;
    }
  }

  function saveResult() {
    alert("ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (3ì¼ í›„ ìë™ ì‚­ì œë©ë‹ˆë‹¤)");
    document.getElementById("saveBtn").style.display = "none";
  }
</script>
</body>
</html>
